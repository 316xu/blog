---
title: æˆ‘æ˜¯å¦‚ä½•åšåˆ°åœ¨ 5 åˆ†é’Ÿä¹‹å†…å°†åº”ç”¨å¤§å°å‡å°‘ 60% çš„
date: 2017-03-24 20:23:00
categories:
- Program
- Android
tags:
- Android
- Program 
- Translation
---

> * åŸæ–‡åœ°å€ï¼š[How you can decrease application size by 60% (In only 5 minutes)?](https://medium.com/@kevalpatel2106/how-you-can-decrease-application-size-by-60-in-only-5-minutes-47eff3e7874e#.n28fz5n36)
> * åŸæ–‡ä½œè€…ï¼šæœ¬æ–‡å·²è·ä½œè€… [Keval Patel](https://medium.com/@kevalpatel2106) æˆæƒ
> * è¯‘æ–‡å‡ºè‡ªï¼š[æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner)
> * è¯‘è€…ï¼š[jifaxu](https://github.com/jifaxu)
> * æ ¡å¯¹è€…ï¼š[gaozp](https://github.com/gaozp), [ZiXYu](https://github.com/ZiXYu)

![](https://image.xujifa.cn/how-you-can-decrease-application-size-by-60-in-only-5-minutes/ZPY2tTbZJXxYsYQ5SWTXhi6CSrhSyXKi)

ç§»åŠ¨è®¾å¤‡çš„èµ„æºæ€»æ˜¯æœ‰é™çš„ã€‚æœ‰é™çš„ç”µé‡ï¼Œæœ‰é™çš„å­˜å‚¨ï¼Œæœ‰é™çš„å¤„ç†èƒ½åŠ›ï¼Œæœ‰é™çš„å†…å­˜ï¼Œæœ‰é™çš„ç½‘ç»œå¸¦å®½â€¦â€¦æ— è®ºä½ é¢å¯¹çš„æ˜¯ Android è¿˜æ˜¯ iOSï¼Œè¿™éƒ½æ˜¯çœŸç†ã€‚
<!-- more -->

åœ¨å‰å‡ ä¸ªæœˆï¼Œæˆ‘åœ¨å¼€å‘ä¸€ä¸ªå®‰å“åº”ç”¨ [**Anti-Theft Screen Lock**](https://play.google.com/store/apps/details?id=com.antitheftlock)ã€‚å½“æœ‰äººå°è¯•ç”¨é”™è¯¯çš„å¯†ç è§£é”è®¾å¤‡æ—¶ï¼Œè¿™ä¸ªåº”ç”¨ä¼šé€šè¿‡å‰ç½®æ‘„åƒå¤´æ‹ç…§å¹¶æ’­æ”¾è­¦ç¤ºéŸ³ã€‚å¦‚æœä½ æƒ³äº†è§£æ›´å¤šï¼Œè¿™é‡Œæœ‰ Play å•†åº—çš„é¡µé¢ï¼š

[**Anti-Theft Screen Lock - Android Apps on Google Play**](https://play.google.com/store/apps/details?id=com.antitheftlock)

åœ¨è¿™å„¿æˆ‘ä¼šæ•™ä½ ä¸€äº›æˆ‘ç”¨æ¥å‡å°åº”ç”¨ä½“ç§¯çš„æŠ€å·§ã€‚è¿™äº›æŠ€å·§éƒ½ç®€å•ä¸”æ˜“ç”¨ï¼Œä¼šåœ¨ç°åœ¨æˆ–å°†æ¥ä¸ºä½ æä¾›ä¸€äº›å¸®åŠ©ã€‚

---

### è¶Šå°è¶Šå¥½

ä½œä¸ºä¸€ä¸ªå¼€å‘è€…æˆ‘ä»¬æ€»æ˜¯æ›´å…³å¿ƒåº”ç”¨çš„æ€§èƒ½ï¼Œè®¾è®¡å’Œç”¨æˆ·ä½“éªŒã€‚ä½†æ˜¯ï¼Œå¤§å¤šæ•°å¼€å‘è€…éƒ½å¿˜äº†ï¼ˆæˆ–ä½ä¼°ï¼‰ä¸€ä»¶äº‹ï¼š**åº”ç”¨ä½“ç§¯**ã€‚å¦‚æœä½ å¸Œæœ›ä½ çš„åº”ç”¨èƒ½å¸å¼•å¤§é‡ç”¨æˆ·ï¼Œè¿™æ˜¯éå¸¸æ ¸å¿ƒçš„ä¸€ç‚¹ã€‚

å¸‚åœºä¸Šå¤§æ¦‚æœ‰ 11000 ç§å®‰å“æœºå‹ï¼Œè€Œå…¶ä¸­å¤§éƒ¨åˆ†éƒ½æ˜¯ä½ç«¯æœºï¼Œæœ‰é™çš„å­˜å‚¨ï¼ˆ1GB åˆ° 8GBï¼‰ï¼Œç”šè‡³ç”¨çš„è¿˜æ˜¯ 2G æˆ–è€… 3G ç½‘ç»œã€‚è¿™äº›è®¾å¤‡åœ¨å°åº¦ï¼Œå·´å…¶å°”ç­‰éæ´²å‘å±•ä¸­å›½å®¶å æœ‰å¤§é‡å¸‚åœºï¼Œä½ å¯ä»¥åœ¨è¿™äº›åœ°æ–¹è·å¾—å¤§é‡çš„ç”¨æˆ·ã€‚

è®©ä½ çš„åº”ç”¨å¤§å°ä¿æŒæœ€ä½³å˜å¾—å°¤å…¶é‡è¦ã€‚**ä½ çš„åº”ç”¨ä½“ç§¯è¶Šå°ï¼Œä½ çš„ç”¨æˆ·å°±æœ‰æ›´å¤šçš„ç©ºé—´æ¥å­˜å‚¨ä»–ä»¬çš„è§†é¢‘å’Œå›¾ç‰‡**ã€‚è¯´å®è¯ï¼Œä½ è‚¯å®šä¸å¸Œæœ›ç”¨æˆ·å› ä¸ºâ€œå­˜å‚¨ç©ºé—´ä¸è¶³â€çš„æç¤ºåˆ é™¤ä½ çš„åº”ç”¨ã€‚

![](https://image.xujifa.cn/how-you-can-decrease-application-size-by-60-in-only-5-minutes/3SQP5skSwcwdJS2G8dE7SRszSjtxNNFh)

å¦‚æœç”¨æˆ·çš„å­˜å‚¨ç©ºé—´ä¸å¤Ÿçš„è¯ï¼Œä»–ä»¬ä¼šå¸è½½ä½ çš„åº”ç”¨ã€‚
è¿™äº›å‘å±•ä¸­å›½å®¶ç”¨æˆ·ä½¿ç”¨çš„ä¾ç„¶æ˜¯é€Ÿåº¦æœ‰é™çš„ 2G/3G ç½‘ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ çš„åº”ç”¨ä½“ç§¯å¤ªå¤§ï¼Œå°†ä¼šéœ€è¦æ›´å¤šçš„æ—¶é—´æ¥ä¸‹è½½ï¼ˆæ›´å¯èƒ½çš„æƒ…å†µæ—¶ç”¨æˆ·æ ¹æœ¬ä¸ä¼šå»ä¸‹è½½ï¼‰ã€‚åŒæ ·çš„ï¼Œå¤§å¤šæ•°ç”¨æˆ·æµé‡æœ‰é™ï¼Œç”¨æˆ·ä¸‹è½½çš„æ¯ä¸ªå­—èŠ‚éƒ½æ˜¯åœ¨èŠ±é’±ã€‚

æ‰€ä»¥ï¼Œå¾ˆæ˜æ˜¾äº†ï¼Œåº”ç”¨ç¨‹åºç•Œçš„çœŸç†å°±æ˜¯ï¼š

> è¶Šå°è¶Šå¥½

---

### ä½¿ç”¨ APK Analyser åˆ†è§£ä½ çš„ APK

Android Studio æä¾›äº†ä¸€ä¸ªæœ‰ç”¨çš„å·¥å…·ï¼š[**APK Analyser**](https://developer.android.com/studio/build/apk-analyzer.html)ã€‚APK Analyser å°†ä¼šæ‹†è§£ä½ çš„åº”ç”¨å¹¶è®©ä½ çŸ¥é“ .apk æ–‡ä»¶ä¸­çš„é‚£ä¸ªéƒ¨åˆ†å æ®äº†å¤§é‡ç©ºé—´ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ Anti-Theft åœ¨æ²¡æœ‰ç»è¿‡ä¼˜åŒ–ä¹‹å‰çš„æˆªå›¾ã€‚

![](https://image.xujifa.cn/how-you-can-decrease-application-size-by-60-in-only-5-minutes/etdpHrESeenRyTMJcXZjXDaF2izP2bix)

ä» Apk Analyser çš„è¾“å‡ºæ¥çœ‹ï¼Œåº”ç”¨çš„åŸå¤§å°æ˜¯ 3.1MBã€‚ç»è¿‡ Play å•†åº—çš„å‹ç¼©ï¼Œå¤§è‡´æ˜¯ 2.5MBã€‚

ä»æˆªå›¾ä¸­å¯ä»¥çœ‹å‡ºä¸»è¦æœ‰ 3 ä¸ªæ–‡ä»¶å¤¹å æ®äº†åº”ç”¨çš„å¤§å¤šæ•°ç©ºé—´ã€‚

- **classes.dex** â€”â€” è¿™æ˜¯ dex æ–‡ä»¶ï¼ŒåŒ…å«äº†æ‰€æœ‰ä¼šè¿è¡Œåœ¨ä½ çš„ DVM æˆ– ART é‡Œçš„å­—èŠ‚ç æ–‡ä»¶ã€‚
- **res** â€”â€” è¿™ä¸ªæ–‡ä»¶å¤¹åŒ…å«äº†æ‰€æœ‰åœ¨ res æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹å®ƒåŒ…å«æ‰€æœ‰å›¾ç‰‡ï¼Œå›¾æ ‡å’Œæºæ–‡ä»¶ï¼Œèœå•æ–‡ä»¶å’Œå¸ƒå±€ã€‚  

![](https://image.xujifa.cn/how-you-can-decrease-application-size-by-60-in-only-5-minutes/pJerm4JBn78pcfRc6iMB5pb2iiRybR45)

- **resources.arsc** â€”â€” è¿™ä¸ªæ–‡ä»¶åŒ…å«äº†æ‰€æœ‰ value èµ„æºã€‚è¿™ä¸ªæ–‡ä»¶åŒ…å«äº†ä½  value ç›®å½•ä¸‹çš„æ‰€æœ‰æ•°æ®ã€‚åŒ…æ‹¬ stringsã€dimensionsã€stylesã€intergersã€ids ç­‰ç­‰ã€‚

![](https://image.xujifa.cn/how-you-can-decrease-application-size-by-60-in-only-5-minutes/saaZshsjMDQcDMTsPjhYcwaDSzEmijp7)

---

æ‰€ä»¥ï¼Œç°åœ¨ä½ çŸ¥é“ APK æ˜¯æ€ä¹ˆç»„æˆçš„äº†ã€‚è®©æˆ‘ä»¬æ¥ç€çœ‹çœ‹è¯¥æ€ä¹ˆä¸€å—å—çš„ä¼˜åŒ–å®ƒä»¥å‡å°åº”ç”¨ä½“ç§¯ã€‚

### **å‡å° classes.dex**

classes.dex åŒ…å«äº†æ‰€æœ‰ Java ä»£ç ã€‚å½“ä½ ç¼–è¯‘ä½ çš„åº”ç”¨æ—¶ï¼Œgradle ä¼šå°†ä½ çš„æ‰€æœ‰æ¨¡å—é‡Œçš„ .class æ–‡ä»¶è½¬æ¢æˆ .dex æ–‡ä»¶å¹¶å°†è¿™äº›æ–‡ä»¶åˆæˆä¸€ä¸ª classes.dex æ–‡ä»¶ã€‚

> å¦‚æœä½ å¾ˆå¥½å¥‡ï¼Œç¼–è¯‘çš„è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Œçœ‹æˆ‘çš„å¦ä¸€ç¯‡åšå®¢ï¼š[The Jack and Jill: Should you use in your next Android Application?](https://blog.mindorks.com/the-jack-and-jill-should-you-use-in-your-next-android-application-ce7d0b0309b7#.gq31gtrdj)

å•ä¸ªçš„ classes.dex æ–‡ä»¶å¯ä»¥å®¹çº³å¤§çº¦ 64K æ–¹æ³•ã€‚å¦‚æœä½ è¾¾åˆ°äº†è¿™ä¸ªé™åˆ¶ï¼Œä½ å¿…é¡»è¦åœ¨ä½ çš„å·¥ç¨‹ä¸­å¯ç”¨ [multidexing](https://developer.android.com/studio/build/multidex.html)ã€‚è¿™å°†ä¼šåˆ›å»ºå¦ä¸€ä¸ª classes1.dex æ–‡ä»¶å»å­˜å‚¨å‰©ä¸‹çš„æ–¹æ³•ã€‚æ‰€ä»¥ classes.dex æ–‡ä»¶æ•°ç›®ç”±ä½ çš„æ–¹æ³•æ•°è€Œå®šã€‚

![](https://image.xujifa.cn/how-you-can-decrease-application-size-by-60-in-only-5-minutes/7EdYnBR8by5X4nF3SQspnR8kbtNG8Sx8)

ä½ å¯ä»¥çœ‹åˆ°ç°åœ¨çš„ â€œAnti-Theft Screen Lockâ€ åŒ…å« 4392 ä¸ªç±»å’Œ 29897 ä¸ªæ–¹æ³•ã€‚è¿™ä¸ªç»“æœæ˜¯æ²¡æœ‰ç»è¿‡æ··æ·†çš„ã€‚ä½ æœ‰ä¸¤ä¸ªé»˜è®¤çš„æ··æ·†æ–‡ä»¶ã€‚

- **proguard-android-optimize.txt**
- **proguard-android.txt**

å°±åƒæ–‡ä»¶åå†™çš„é‚£æ ·ï¼Œâ€œ*proguard-android-optimize.txt*â€æ˜¯æ›´ç§¯æçš„æ··æ·†é€‰é¡¹ã€‚æˆ‘ä»¬å°†è¿™ä¸ªä½œä¸ºé»˜è®¤çš„æ··æ·†é…ç½®ã€‚ä½ å¯ä»¥åœ¨ */app* ç›®å½•ä¸‹çš„ *proguard-rules.pro* é‡Œæ·»åŠ è‡ªå®šä¹‰çš„æ··æ·†é…ç½®ã€‚

```
 release {
    //Enable the proguard
    minifyEnabled true
    proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), "proguard-rules.pro"

    //Other parameters
    debuggable false
    jniDebuggable false
    renderscriptDebuggable false
    signingConfig playStoreConfig //Add your own signing config
    pseudoLocalesEnabled false
    zipAlignEnabled true
}
```

é€šè¿‡è®¾ç½® *minifyEnabled* ä¸º trueï¼Œæ··æ·†å°†ä¼šç§»é™¤æ‰€æœ‰æœªä½¿ç”¨çš„æ–¹æ³•ã€æŒ‡ä»¤ä»¥å‡å° classes.dex æ–‡ä»¶ã€‚

è¿™æ˜¯å¯ç”¨äº† minify ä¹‹åçš„ APKã€‚

![](https://image.xujifa.cn/how-you-can-decrease-application-size-by-60-in-only-5-minutes/aMEsinXACacyQEWs4MDDk8hZzGWbMfSZ)

ä½ å¯ä»¥çœ‹åˆ°åœ¨ä¸ºæ¯ä¸ªæ¨¡å—å¯ç”¨äº†æ··æ·†ä¹‹åæˆ‘ä»¬çš„ classes.dex å¤§å°å‡å°äº†å‡ ä¹ 50%ã€‚åŒæ—¶ä½ å¯ä»¥çœ‹åˆ°æ–¹æ³•æ•°ä» 29897 é™åˆ°äº† 15168ï¼ˆå‡ ä¹ 50%ï¼‰ã€‚æ­å–œâ€¦â€¦ğŸŠğŸ‰

> ä½“ç§¯ä» 3.1MB é™åˆ°äº† 1.98MBã€‚**(ç¼©å°çº¦ 50%)**

---

### å‡å° resï¼š

ä¸‹ä¸€å¤§å—å°±æ˜¯ res æ–‡ä»¶å¤¹ï¼Œå®ƒåŒ…æ‹¬äº†æ‰€æœ‰çš„å›¾ç‰‡ï¼Œraw æ–‡ä»¶å’Œ XMLã€‚ä½ ä¸èƒ½æ·»åŠ /åˆ é™¤/ä¿®æ”¹ä½ çš„ XMLï¼Œå› ä¸ºå®ƒä»¬åŒ…å«äº†ä½ çš„å¸ƒå±€ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥å‡å°å›¾ç‰‡æ–‡ä»¶ã€‚

- â€œ***shrinkResources***â€ å±æ€§å°†ä¼šç§»é™¤æ‰€æœ‰åœ¨å·¥ç¨‹ä¸­æ²¡æœ‰ç”¨åˆ°çš„èµ„æºã€‚åœ¨ build.gradle ä¸­åƒä¸‹é¢è¿™æ ·å¯ç”¨å®ƒï¼š

```
release{
  //...
  //...
  shrinkResources true
  //...
}
```

- â€œ***resConfigs***â€ å±æ€§å°†ä¼šåœ¨æ„å»ºè¿‡ç¨‹ä¸­ç§»é™¤æ‰€æœ‰æœ¬åœ°åŒ–èµ„æºã€‚app â€œAnti-Theft Screen Lockâ€ åªéœ€è¦æ”¯æŒè‹±è¯­ã€‚è€Œå¾ˆå¤šçš„æ”¯æŒåº“éƒ½å¯èƒ½æœ‰å…¶å®ƒè¯­è¨€çš„æœ¬åœ°åŒ–æ–‡ä»¶å¤¹ã€‚è¿™äº›æ˜¯æˆ‘ä¸éœ€è¦çš„ã€‚æ‰€ä»¥ï¼Œæ·»åŠ ä¸‹é¢çš„è¿™äº›ä»£ç è®©åº”ç”¨åªæ”¯æŒè‹±è¯­ã€‚

```
defaultConfig {
    //...
    //...
    //...

    //strip other than english resources
    resConfigs "en"
}
```

- å¦‚æœä½ åœ¨ç”¨ Android Studio 2.3ï¼Œå¹¶ä¸”ä½ çš„åº”ç”¨çš„æœ€ä½æ”¯æŒç‰ˆæœ¬å¤§äº 18ï¼Œä½ å¯ä»¥ä½¿ç”¨ [**webp**](https://en.wikipedia.org/wiki/WebP) æ›¿ä»£ pngã€‚webp å›¾ç‰‡æ¯” png ä½“ç§¯æ›´å°ä½†è´¨é‡ä¸€æ ·ã€‚è€Œä¸” Android æ”¯æŒ webpã€‚æ‰€ä»¥ä½ å¯ä»¥åœ¨ ImageView ä¸­åƒåŠ è½½å…¶å®ƒå…‰æ …å›¾ç‰‡ä¸€æ ·åŠ è½½ webp å›¾ç‰‡ã€‚è¿™ä¸éœ€è¦æ”¹å˜ä½ çš„å¸ƒå±€ã€‚

ä½ å¯ä»¥åœ¨å·¥ç¨‹é€‰æ‹© drawable å’Œ mipmap æ–‡ä»¶å¤¹ï¼Œå³å‡»å¹¶é€‰æ‹© **convert to webp**ã€‚è¿™å°†ä¼šæ‰“å¼€ä¸‹é¢è¿™æ ·çš„é…ç½®å¼¹æ¡†ã€‚

![](https://image.xujifa.cn/how-you-can-decrease-application-size-by-60-in-only-5-minutes/cdGSJa6AtzHfXHhiQcNF2HNyjP5zAazX)

ç‚¹å‡» okï¼Œå°†ä¼šå°†æ‰€æœ‰ png å›¾ç‰‡è½¬æˆ webpã€‚å¦‚æœ webp å›¾ç‰‡æ¯” png æ›´å¤§ï¼ŒAndroid Studio å°†ä¼šè‡ªåŠ¨è·³è¿‡è¿™ä¸ªæ–‡ä»¶ã€‚

è®©æˆ‘ä»¬çœ‹ä¸‹æœ€ç»ˆæ•ˆæœï¼š

![](https://image.xujifa.cn/how-you-can-decrease-application-size-by-60-in-only-5-minutes/Pn4nSTaPSYBTRJD8NArRaPANk7KCcYxZ)

å–”ï¼ï¼ï¼res æ–‡ä»¶å¤¹ä» 710KB é™åˆ°äº† 597KBã€‚

> ä½“ç§¯å‡å°äº† 105KBã€‚ï¼ˆé™ä½äº† 16%ï¼‰

> ä½ ä¹Ÿå¯ä»¥å°†å›¾ç‰‡è½¬ä¸ºçŸ¢é‡å›¾ã€‚ä½†æ˜¯è¿™æ ·ä½ éœ€è¦å¯¹å®ƒçš„å‘åå…¼å®¹æ€§è¿›è¡Œä¸€äº›å¤„ç†ã€‚å¦‚æœä½ æƒ³äº†è§£æ›´å¤š vector çš„ç›¸å…³çŸ¥è¯†ï¼Œçœ‹çœ‹ [Chris Banes çš„è¿™ç¯‡åšå®¢](https://medium.com/@chrisbanes/appcompat-v23-2-age-of-the-vectors-91cbafa87c88#.ust6pssbk)ã€‚

---

### TL;DR:

- é€šè¿‡åœ¨ä½ çš„ release build type ä¸­åŠ ä¸Šä¸‹é¢è¿™äº›ä»£ç å¯ç”¨æ··æ·†ã€‚
- å¯ç”¨ shrinkResourcesã€‚
- é€šè¿‡åœ¨ â€œresConfigsâ€ é‡Œæ·»åŠ éœ€è¦çš„èµ„æºåç§»é™¤æ‰€æœ‰ä¸éœ€è¦çš„æœ¬åœ°åŒ–èµ„æºã€‚
- å°†æ‰€æœ‰å›¾ç‰‡è½¬ä¸º webp æˆ–è€…çŸ¢é‡å›¾ã€‚

---

### æ€»ç»“ï¼š

é€šè¿‡ä½¿ç”¨ä¸Šé¢è¿™äº›ç®€å•çš„æŠ€å·§æˆ‘å°†åº”ç”¨ä½“ç§¯ä» 3.19MB é™è‡³äº† 1.89MBã€‚


è¿™äº›åªæ˜¯æœ€ç®€å•çš„æ–¹å¼ï¼Œè¿˜æœ‰å¾ˆå¤šå‡å°åº”ç”¨ä½“ç§¯çš„æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œä½ åº”è¯¥å§‹ç»ˆä½¿ç”¨ä¸Šé¢è¿™äº›ç®€å•çš„æ–¹æ³•æ¥ä¿è¯å·²ç»å°½å¯èƒ½çš„å‡å°äº†åº”ç”¨ä½“ç§¯ã€‚

ä½ å¯ä»¥åœ¨[è¿™å„¿](https://developer.android.com/topic/performance/reduce-apk-size.html)å­¦ä¹ æ›´å¤šçš„æŠ€å·§ã€‚

> è®°ä½ï¼šè¶Šå°è¶Šå¥½ã€‚ğŸ˜‰
